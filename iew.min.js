"use strict";let components=[],componentsElements=[];const ewmport=e=>{".iew"!=e.substr("-4")&&(e+=".iew"),components.push(e)},Iew=e=>{_init(e),console.log("IEW: Initialized")},_init=options=>{let app=document.querySelector(options.el);const createState=e=>new Proxy(e,{set:(e,t,n)=>(e[t]=n,render(),!0)}),render=()=>{app=document.querySelector(options.el),setBindings(app,state),setEventBindings(app,options.methods,state),setIfs(app,state)},state=createState(options.data),listeners=app.querySelectorAll("[ew-model]");listeners.forEach(e=>{const t=e.getAttribute("ew-model");e.addEventListener("change",n=>state[t]=e.value),e.addEventListener("input",n=>state[t]=e.value)});const ewmports=()=>{for(let i=0;i<components.length;i++)readIEW(components[i],res=>{let html=stringToHTML(res),title=html.querySelector("title"),content=html.querySelector("content"),script=html.querySelector("script"),componentExport=eval(script.innerHTML),i=0;Array.from(app.getElementsByTagName(title.innerText)).forEach(el=>{html=stringToHTML(res),title=html.querySelector("title"),content=html.querySelector("content"),script=html.querySelector("script"),componentExport=eval(script.innerHTML),el.id=i++;let willReplace=content.querySelector("div");el.replaceWith(willReplace),componentsElements.push({title:title,element:willReplace,script:componentExport})}),options.data.components!=typeof Array&&(options.data.components=[]),options.data.components=componentsElements;let a=0;componentsElements.forEach(e=>{setBindings(e.element,state.components[a].script.data),setEventBindings(e.element,e.script,state.components[a].script.data),a++}),render()})},setEventBindings=(e,t,n)=>{Array.from(e.querySelectorAll("[ew-onclick]")).map(e=>e.getAttribute("ew-onclick")).forEach(o=>{e.querySelector(`[ew-onclick=${o}]`).addEventListener("click",()=>{null!=t.data&&(t.methods.data=t.data,t.methods[o](),t.data=t.methods.data,delete t.methods.data),setBindings(e,n)})})};ewmports(),render(),options.created()},setBindings=(e,t)=>{Array.from(e.querySelectorAll("[ew-bind]")).map(e=>e.getAttribute("ew-bind")).forEach(n=>{if(null!=t[n]){const o=e.querySelector(`[ew-bind=${n}]`),r=e.querySelector(`[ew-model=${n}]`);null!=o&&(o.innerHTML=t[n]),null!=r&&(r.value=t[n])}})},setIfs=(e,t)=>{const n=Array.from(e.querySelectorAll("[ew-if]"));console.log("bindings",n),n.forEach(e=>{const t=1==e.getAttribute("ew-if");let n=!1;ifs.forEach(o=>{if(o.element==e)return n=!0,o.isTrue=t}),n||ifs.push({element:e,isTrue:t})})},setComponentBindings=()=>{Array.from(el.element.querySelectorAll("[ew-bind]")).map(e=>e.getAttribute("ew-bind")).forEach(e=>{if(null!=state.components[i].script.data[e]){const t=el.element.querySelector(`[ew-bind=${e}]`),n=el.element.querySelector(`[ew-model=${e}]`);null!=t&&(t.innerHTML=state.components[i].script.data[e]),null!=n&&(n.value=state.components[i].script.data[e])}})},readIEW=(e,t)=>{var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="blob",n.onload=function(e){if(200==this.status){var n=new File([this.response],"temp"),o=new FileReader;o.addEventListener("load",function(){t(o.result)}),o.readAsText(n)}},n.send()},stringToHTML=function(e){const t=document.createElement("div");return t.innerHTML=e,t};